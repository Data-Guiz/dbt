version: 2

models:
  - name: hsat_cp_booking
    description: "Table satellite contenant les attributs détaillés des réservations"
    columns:
      - name: booking_hk
        description: "Clé de hachage de la réservation"
        tests:
          - not_null
          - unique
          - relationships:
              to: source('dv', 'hub_booking')
              field: booking_hk

      - name: load_dts
        description: "Date de chargement"
        tests:
          - not_null

      - name: load_end_dts
        description: "Date de fin de validité"
        tests:
          - not_null

      - name: del_flag
        description: "Indicateur de suppression"
        tests:
          - not_null

      - name: bookingstatuscode
        description: "Code de statut de la réservation"
        tests:
          - not_null
          - accepted_values:
              values: ['NEW', 'CNF', 'CXL', 'OPT']

      - name: bookeddate__date
        description: "Date de réservation"
        tests:
          - not_null
          - dbt_utils.date_after:
              datepart: day
              field: '1900-01-01'

      - name: bkgdepartdate__date
        description: "Date de départ"
        tests:
          - dbt_utils.date_after:
              datepart: day
              field: '1900-01-01'

      - name: bkgreturndate__date
        description: "Date de retour"
        tests:
          - dbt_utils.date_after:
              datepart: day
              field: '1900-01-01'

      - name: totalinvoiceamount__number
        description: "Montant total de la facture"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"

      - name: totalgrossprice__number
        description: "Prix brut total"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"

      - name: totalnetprice__number
        description: "Prix net total"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"

  - name: hsat_cp_product
    description: "Table satellite des attributs de produit de croisière"
    columns:
      - name: cruise_hk
        description: "Clé hash du produit de croisière"
        tests:
          - not_null
          - unique:
              combination_of: [cruise_hk, load_dts]
          - relationships:
              to: source('dv', 'hub_cruise')
              field: cruise_hk

      - name: load_dts
        description: "Date de chargement"
        tests:
          - not_null

      - name: load_end_dts
        description: "Date de fin de validité"
        tests:
          - not_null

      - name: del_flag
        description: "Flag de suppression"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: hash_diff
        description: "Hash des attributs"
        tests:
          - not_null

      - name: record_source
        description: "Source des données"
        tests:
          - not_null

      - name: dv_run_id
        description: "ID de l'exécution"
        tests:
          - not_null

      - name: file_name
        description: "Nom du fichier source"

      - name: datetime_from_file_name
        description: "Date/heure extraite du nom du fichier"

      - name: controllingoffice
        description: "Bureau de contrôle"

      - name: ischartedcruise
        description: "Indicateur de croisière affrétée"
        tests:
          - accepted_values:
              values: ['YES', 'NO', null]

      - name: embarkdate
        description: "Date d'embarquement (format texte)"

      - name: embarkdate__date
        description: "Date d'embarquement (format date)"
        tests:
          - dbt_utils.date_after:
              datepart: day
              field: '1900-01-01'
          - dbt_utils.date_before:
              datepart: day
              field: '2100-12-31'

      - name: disembarkdate
        description: "Date de débarquement (format texte)"

      - name: disembarkdate__date
        description: "Date de débarquement (format date)"
        tests:
          - dbt_utils.date_after:
              datepart: day
              field: '1900-01-01'
          - dbt_utils.date_before:
              datepart: day
              field: '2100-12-31'

      - name: region
        description: "Région de la croisière"

      - name: cruiseid
        description: "Identifiant de la croisière"

      - name: shipcode
        description: "Code du navire"

      - name: embarkat
        description: "Port d'embarquement"

      - name: disembarkat
        description: "Port de débarquement"

      - name: configurationcode
        description: "Code de configuration"

      - name: cruisetype
        description: "Type de croisière"

      - name: technicalincidenttype
        description: "Type d'incident technique"

      - name: technicalincidentcriticity
        description: "Criticité de l'incident technique"

      - name: season
        description: "Saison"

      - name: vip
        description: "Indicateur VIP"
        tests:
          - accepted_values:
              values: ['YES', 'NO', null]

      - name: vipname
        description: "Nom du VIP"

      - name: expedition
        description: "Indicateur d'expédition"
        tests:
          - accepted_values:
              values: ['YES', 'NO', null]

      - name: controlcapacity
        description: "Contrôle de capacité"

      - name: prepostsalesopeningdate
        description: "Date d'ouverture des ventes pré/post (format texte)"

      - name: prepostsalesopeningdate__date
        description: "Date d'ouverture des ventes pré/post (format date)"
        tests:
          - dbt_utils.date_after:
              datepart: day
              field: '1900-01-01'
          - dbt_utils.date_before:
              datepart: day
              field: '2100-12-31'

      - name: excsalesopeningdate
        description: "Date d'ouverture des ventes exclusives (format texte)"

      - name: excsalesopeningdate__date
        description: "Date d'ouverture des ventes exclusives (format date)"
        tests:
          - dbt_utils.date_after:
              datepart: day
              field: '1900-01-01'
          - dbt_utils.date_before:
              datepart: day
              field: '2100-12-31'

      - name: status
        description: "Statut du produit"

  - name: hsat_sf_account
    description: "Table satellite des comptes Salesforce"
    columns:
      - name: sf_account_hk
        description: "Clé hash du compte Salesforce"
        tests:
          - not_null
          - relationships:
              to: source('dv', 'hub_sf_account')
              field: sf_account_hk

      - name: load_dts
        description: "Date de chargement"
        tests:
          - not_null

      - name: load_end_dts
        description: "Date de fin de validité"
        tests:
          - not_null
          - dbt_utils.date_after:
              datepart: day
              field: load_dts

      - name: del_flag
        description: "Indicateur de suppression"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: hash_diff
        description: "Différence de hash"
        tests:
          - not_null

      - name: record_source
        description: "Source des données"
        tests:
          - not_null

      - name: dv_run_id
        description: "ID de l'exécution"
        tests:
          - not_null

      - name: name
        description: "Nom du compte"
        tests:
          - not_null

      - name: type
        description: "Type de compte"
        tests:
          - accepted_values:
              values: ['Customer', 'Prospect', 'Partner', 'Other']

      - name: billingcountry
        description: "Pays de facturation"
        tests:
          - not_null

      - name: shippingcountry
        description: "Pays de livraison"
        tests:
          - not_null

      - name: createddate
        description: "Date de création"
        tests:
          - not_null

  - name: lsat_cp_booking_cruise
    description: "Table satellite contenant les détails des croisières pour les réservations"
    columns:
      - name: booking__item__cruise__vessel__cabin_hk
        description: "Clé de hachage de la liaison"
        tests:
          - not_null
          - relationships:
              to: source('dv', 'link_booking__item__cruise__vessel__cabin')
              field: booking__item__cruise__vessel__cabin_hk
      - name: load_dts
        description: "Date de chargement"
        tests:
          - not_null
      - name: load_end_dts
        description: "Date de fin de validité"
        tests:
          - not_null
          - dbt_utils.date_after:
              datepart: day
              field: load_dts
      - name: del_flag
        description: "Indicateur de suppression"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: hash_diff
        description: "Différence de hachage pour le suivi des changements"
        tests:
          - not_null
      - name: record_source
        description: "Source des données"
        tests:
          - not_null
      - name: dv_run_id
        description: "Identifiant d'exécution Data Vault"
        tests:
          - not_null
      - name: file_name
        description: "Nom du fichier source"
      - name: datetime_from_file_name
        description: "Date et heure extraites du nom du fichier"
      - name: itemstatuscode
        description: "Code de statut de l'élément"
        tests:
          - not_null
      - name: itemstatusdesc
        description: "Description du statut de l'élément"
      - name: cruiseid
        description: "Identifiant de la croisière"
      - name: shipname
        description: "Nom du navire"
      - name: shipgraphicsurl
        description: "URL des graphiques du navire"
      - name: sailingdate
        description: "Date de départ (format texte)"
      - name: sailingdate__date
        description: "Date de départ (format date)"
      - name: sailingtime
        description: "Heure de départ"
      - name: sailingcountry
        description: "Pays de départ"
      - name: sailingport
        description: "Port de départ"
      - name: stdsailingport
        description: "Port de départ standardisé"
      - name: returndate
        description: "Date de retour (format texte)"
      - name: returndate__date
        description: "Date de retour (format date)"
      - name: returncountry
        description: "Pays de retour"
      - name: returnport
        description: "Port de retour"
      - name: stdreturnport
        description: "Port de retour standardisé"
      - name: sailinglengthdays
        description: "Durée de la croisière en jours"
      - name: itinerarycode
        description: "Code de l'itinéraire"
      - name: itinerarydescription
        description: "Description de l'itinéraire"
      - name: categorycode
        description: "Code de la catégorie"
      - name: categorydesc
        description: "Description de la catégorie"
      - name: promotioncode
        description: "Code de la promotion"
      - name: promotiontype
        description: "Type de promotion"
      - name: promotiondesc
        description: "Description de la promotion"
      - name: waitlistcategorycode
        description: "Code de la catégorie en liste d'attente"
      - name: waitlistcabinno
        description: "Numéro de cabine en liste d'attente"
      - name: bookedpromotionamount
        description: "Montant de la promotion réservée"
      - name: brochureprice
        description: "Prix du catalogue"
      - name: amountsavedbychossingpromo
        description: "Montant économisé grâce à la promotion"

  - name: hsat_MM_cruise
    description: "Table satellite des croisières"
    columns:
      - name: mm_cruise_hk
        description: "Clé de hachage de la croisière"
        tests:
          - not_null
          - relationships:
              to: source('dv', 'hub_mm_cruise')
              field: mm_cruise_hk
      - name: load_dts
        description: "Date de chargement"
        tests:
          - not_null
      - name: load_end_dts
        description: "Date de fin de validité"
        tests:
          - not_null
      - name: del_flag
        description: "Indicateur de suppression"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: hash_diff
        description: "Différence de hachage"
        tests:
          - not_null
      - name: record_source
        description: "Source des données"
        tests:
          - not_null
      - name: dv_run_id
        description: "Identifiant d'exécution"
        tests:
          - not_null
      - name: date_departure
        description: "Date de départ"
        tests:
          - not_null
      - name: los
        description: "Longueur du séjour"
        tests:
          - not_null
      - name: cruise_status
        description: "Statut de la croisière"
        tests:
          - not_null
      - name: capacity_pax
        description: "Capacité en passagers"
        tests:
          - not_null
      - name: dte_debut_validite
        description: "Date de début de validité"
        tests:
          - not_null
      - name: dte_fin_validite
        description: "Date de fin de validité"
        tests:
          - not_null

  - name: hsat_MR_cabin_number
    description: "Table satellite des numéros de cabine"
    columns:
      - name: mr_cabin_number_hk
        description: "Clé de hachage du numéro de cabine"
        tests:
          - not_null
          - relationships:
              to: source('dv', 'hub_mr_cabin_number')
              field: mr_cabin_number_hk
      - name: load_dts
        description: "Date de chargement"
        tests:
          - not_null
      - name: load_end_dts
        description: "Date de fin de validité"
        tests:
          - not_null
      - name: del_flag
        description: "Indicateur de suppression"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: hash_diff
        description: "Différence de hachage"
        tests:
          - not_null
      - name: record_source
        description: "Source des données"
        tests:
          - not_null
      - name: dv_run_id
        description: "Identifiant d'exécution"
        tests:
          - not_null
      - name: cabin_no
        description: "Numéro de cabine"
        tests:
          - not_null
      - name: cabin_id
        description: "Identifiant de la cabine"
        tests:
          - not_null
      - name: cabin_shipboard
        description: "Position de la cabine à bord"
        tests:
          - not_null
      - name: cabin_position
        description: "Position de la cabine"
        tests:
          - not_null
      - name: capacity_cabin
        description: "Capacité de la cabine"
        tests:
          - not_null
      - name: capacity_pax
        description: "Capacité en passagers"
        tests:
          - not_null

  - name: hsat_MR_vessel_configuration
    description: "Table satellite des configurations des navires"
    columns:
      - name: mr_vessel_configuration_hk
        description: "Clé de hachage de la configuration du navire"
        tests:
          - not_null
          - relationships:
              to: source('dv', 'hub_mr_vessel_configuration')
              field: mr_vessel_configuration_hk
      - name: load_dts
        description: "Date de chargement"
        tests:
          - not_null
      - name: load_end_dts
        description: "Date de fin de validité"
        tests:
          - not_null
      - name: del_flag
        description: "Indicateur de suppression"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: hash_diff
        description: "Différence de hachage"
        tests:
          - not_null
      - name: record_source
        description: "Source des données"
        tests:
          - not_null
      - name: dv_run_id
        description: "Identifiant d'exécution"
        tests:
          - not_null
      - name: start_date
        description: "Date de début de validité de la configuration"
        tests:
          - not_null
      - name: end_date
        description: "Date de fin de validité de la configuration"
        tests:
          - not_null

  - name: lsat_MM_cruise
    description: "Table satellite pour les croisières"
    columns:
      - name: mm_cruise__cruise__vessel_hk
        description: "Clé de hachage de la liaison entre croisière et navire"
        tests:
          - not_null
          - unique
          - relationships:
              to: source('dv', 'link_mm_cruise__cruise__vessel')
              field: mm_cruise__cruise__vessel_hk
      - name: load_dts
        description: "Date de chargement"
        tests:
          - not_null
      - name: load_end_dts
        description: "Date de fin de validité"
        tests:
          - not_null
      - name: del_flag
        description: "Indicateur de suppression"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: hash_diff
        description: "Différence de hachage"
        tests:
          - not_null
      - name: record_source
        description: "Source des données"
        tests:
          - not_null
      - name: dv_run_id
        description: "Identifiant d'exécution"
        tests:
          - not_null

sources:
  - name: dv
    database: dev
    schema: dv
    tables:
      - name: hsat_cp_booking
        description: "Table source des attributs de réservation"
        columns:
          - name: booking_hk
            description: "Clé de hachage de la réservation"
          - name: load_dts
            description: "Date de chargement"
          - name: load_end_dts
            description: "Date de fin de validité"
          - name: del_flag
            description: "Indicateur de suppression"
      - name: hsat_cp_product
        description: "Table satellite des attributs de produit de croisière"
        columns:
          - name: cruise_hk
            description: "Clé hash du produit de croisière"
          - name: load_dts
            description: "Date de chargement"
          - name: load_end_dts
            description: "Date de fin de validité"
          - name: del_flag
            description: "Flag de suppression"
          - name: hash_diff
            description: "Hash des attributs"
          - name: record_source
            description: "Source des données"
          - name: dv_run_id
            description: "ID de l'exécution"
          - name: file_name
            description: "Nom du fichier source"
          - name: datetime_from_file_name
            description: "Date/heure extraite du nom du fichier"
          - name: controllingoffice
            description: "Bureau de contrôle"
          - name: ischartedcruise
            description: "Indicateur de croisière affrétée"
          - name: embarkdate
            description: "Date d'embarquement (format texte)"
          - name: embarkdate__date
            description: "Date d'embarquement (format date)"
          - name: disembarkdate
            description: "Date de débarquement (format texte)"
          - name: disembarkdate__date
            description: "Date de débarquement (format date)"
          - name: region
            description: "Région de la croisière"
          - name: cruiseid
            description: "Identifiant de la croisière"
          - name: shipcode
            description: "Code du navire"
          - name: embarkat
            description: "Port d'embarquement"
          - name: disembarkat
            description: "Port de débarquement"
          - name: configurationcode
            description: "Code de configuration"
          - name: cruisetype
            description: "Type de croisière"
          - name: technicalincidenttype
            description: "Type d'incident technique"
          - name: technicalincidentcriticity
            description: "Criticité de l'incident technique"
          - name: season
            description: "Saison"
          - name: vip
            description: "Indicateur VIP"
          - name: vipname
            description: "Nom du VIP"
          - name: expedition
            description: "Indicateur d'expédition"
          - name: controlcapacity
            description: "Contrôle de capacité"
          - name: prepostsalesopeningdate
            description: "Date d'ouverture des ventes pré/post (format texte)"
          - name: prepostsalesopeningdate__date
            description: "Date d'ouverture des ventes pré/post (format date)"
          - name: excsalesopeningdate
            description: "Date d'ouverture des ventes exclusives (format texte)"
          - name: excsalesopeningdate__date
            description: "Date d'ouverture des ventes exclusives (format date)"
          - name: status
            description: "Statut du produit"
      - name: hsat_sf_account
        description: "Table satellite des comptes Salesforce"
        columns:
          - name: sf_account_hk
            description: "Clé hash du compte Salesforce"
          - name: load_dts
            description: "Date de chargement"
          - name: load_end_dts
            description: "Date de fin de validité"
          - name: del_flag
            description: "Indicateur de suppression"
          - name: hash_diff
            description: "Différence de hash"
          - name: record_source
            description: "Source des données"
          - name: dv_run_id
            description: "ID de l'exécution"
          - name: name
            description: "Nom du compte"
          - name: type
            description: "Type de compte"
          - name: billingcountry
            description: "Pays de facturation"
          - name: shippingcountry
            description: "Pays de livraison"
          - name: createddate
            description: "Date de création"
      - name: lsat_cp_booking_cruise
        description: "Table satellite contenant les détails des croisières pour les réservations"
        columns:
          - name: booking__item__cruise__vessel__cabin_hk
            description: "Clé de hachage de la liaison"
          - name: load_dts
            description: "Date de chargement"
          - name: load_end_dts
            description: "Date de fin de validité"
          - name: del_flag
            description: "Indicateur de suppression"
          - name: hash_diff
            description: "Différence de hachage pour le suivi des changements"
          - name: record_source
            description: "Source des données"
          - name: dv_run_id
            description: "Identifiant d'exécution Data Vault"
          - name: file_name
            description: "Nom du fichier source"
          - name: datetime_from_file_name
            description: "Date et heure extraites du nom du fichier"
          - name: itemstatuscode
            description: "Code de statut de l'élément"
          - name: itemstatusdesc
            description: "Description du statut de l'élément"
          - name: cruiseid
            description: "Identifiant de la croisière"
          - name: shipname
            description: "Nom du navire"
          - name: shipgraphicsurl
            description: "URL des graphiques du navire"
          - name: sailingdate
            description: "Date de départ (format texte)"
          - name: sailingdate__date
            description: "Date de départ (format date)"
          - name: sailingtime
            description: "Heure de départ"
          - name: sailingcountry
            description: "Pays de départ"
          - name: sailingport
            description: "Port de départ"
          - name: stdsailingport
            description: "Port de départ standardisé"
          - name: returndate
            description: "Date de retour (format texte)"
          - name: returndate__date
            description: "Date de retour (format date)"
          - name: returncountry
            description: "Pays de retour"
          - name: returnport
            description: "Port de retour"
          - name: stdreturnport
            description: "Port de retour standardisé"
          - name: sailinglengthdays
            description: "Durée de la croisière en jours"
          - name: itinerarycode
            description: "Code de l'itinéraire"
          - name: itinerarydescription
            description: "Description de l'itinéraire"
          - name: categorycode
            description: "Code de la catégorie"
          - name: categorydesc
            description: "Description de la catégorie"
          - name: promotioncode
            description: "Code de la promotion"
          - name: promotiontype
            description: "Type de promotion"
          - name: promotiondesc
            description: "Description de la promotion"
          - name: waitlistcategorycode
            description: "Code de la catégorie en liste d'attente"
          - name: waitlistcabinno
            description: "Numéro de cabine en liste d'attente"
          - name: bookedpromotionamount
            description: "Montant de la promotion réservée"
          - name: brochureprice
            description: "Prix du catalogue"
          - name: amountsavedbychossingpromo
            description: "Montant économisé grâce à la promotion"
      - name: hub_mm_cruise
        description: "Table hub des croisières"
      - name: hub_mr_cabin_number
        description: "Table hub des numéros de cabine"
      - name: hub_mr_vessel_configuration
        description: "Table hub des configurations des navires"
      - name: link_mm_cruise__cruise__vessel
        description: "Table de liaison entre croisières et navires" 